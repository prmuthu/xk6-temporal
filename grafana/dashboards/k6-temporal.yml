# dashboard.yaml
title: K6 Temporal

editable: true
tags: [generated]
time: [now-30m, now]
auto_refresh: 10s
shared_crosshair: true

variables:
  - interval:
      name: interval
      label: Interval
      values: ["30s", "1m", "5m"]
      default: 1m

rows:
  - name: K6
    panels:
      - graph:
          title: VUs
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: "k6_vus"
                legend: "VU"
      - graph:
          title: Iteration Rate
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: sum (rate(k6_iterations[$interval])) by (scenario)
                legend: "{{scenario}}"
      - graph:
          title: Dropped iterations
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: sum (rate(k6_dropped_iterations[$interval])) by (scenario)
                legend: "{{scenario}}"
      - graph:
          title: Iteration Duration 95%ile
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: avg (k6_iteration_duration_p95{scenario=~".+"}) by (scenario)
                legend: "{{scenario}}"
          axes:
            left: { unit: ms }
  - name: RPC
    panels:
      - graph:
          title: Request Rate
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: sum (rate(k6_temporal_request[$interval])) by (operation)
                legend: "{{operation}}"
            - prometheus:
                query: sum (rate(k6_temporal_long_request[$interval])) by (operation)
                legend: "{{operation}}"
      - graph:
          title: Request Latency p95
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: avg (k6_temporal_request_latency_p95) by (operation)
                legend: "{{operation}}"
          axes:
            left: { unit: ms }
      - graph:
          title: Progress Response Latency p95
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: avg (k6_temporal_request_latency_p95{operation=~"RecordActivityTaskHeartbeat|RespondWorkflowTaskCompleted|RespondActivityTaskCompleted"}) by (operation)
                legend: "{{operation}}"
          axes:
            left: { unit: ms }
      - graph:
          title: External Event Request Latency p95
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: avg (k6_temporal_request_latency_p95{operation=~"StartWorkflowExecution|SignalWithStartWorkflowExecution|RequestCancelWorkflowExecution|SignalWorkflowExecution|TerminateWorkflowExecution"}) by (operation)
                legend: "{{operation}}"
          axes:
            left: { unit: ms }
      - graph:
          title: Long Poll Request Latency p95
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: avg (k6_temporal_long_request_latency_p95) by (operation)
                legend: "{{operation}}"
          axes:
            left: { unit: ms }
  - name: Workflows
    panels:
      - graph:
          title: Workflow Completion Rate
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: sum (rate(k6_temporal_workflow_completed[$interval])) by (task_queue, workflow_type)
                legend: "{{task_queue}} {{workflow_type}}"
      - graph:
          title: Workflow Completion Latency p95
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: avg (k6_temporal_workflow_endtoend_latency_p95) by (task_queue, workflow_type)
                legend: "{{task_queue}} {{workflow_type}}"
          axes:
            left: { unit: ms }
      - graph:
          title: Workflow Task Execution Latency
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: avg (k6_temporal_workflow_task_execution_latency_p95) by (workflow_type)
                legend: "{{workflow_type}}"
          axes:
            left: { unit: ms }
      - graph:
          title: Workflow Task Schedule to Start Latency
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: avg (k6_temporal_workflow_task_schedule_to_start_latency_p95) by (workflow_type)
                legend: "{{workflow_type}}"
          axes:
            left: { unit: ms }
  - name: Activities
    panels:
      - graph:
          title: Activity Execution Latency
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: avg (k6_temporal_activity_execution_latency_p95) by (activity_type)
                legend: "{{task_queue}} {{activity_type}}"
          axes:
            left: { unit: ms }
      - graph:
          title: Activity Task Schedule to Start Latency
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: avg (k6_temporal_activity_schedule_to_start_latency_p95) by (activity_type)
                legend: "{{task_queue}} {{activity_type}}"
          axes:
            left: { unit: ms }
  - name: Persistence
    panels:
      - graph:
          title: Create/Update Workflow Rate
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: sum (rate(persistence_requests{operation=~"CreateWorkflowExecution|UpdateWorkflowExecution"}[$interval])) by (operation)
                legend: "{{operation}}"
      - graph:
          title: Create Workflow Latency
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: histogram_quantile(0.90, sum(rate(persistence_latency_bucket{operation="CreateWorkflowExecution"}[$interval])) by (namespace, le)) * 1000
                legend: "90"
            - prometheus:
                query: histogram_quantile(0.95, sum(rate(persistence_latency_bucket{operation="CreateWorkflowExecution"}[$interval])) by (namespace, le)) * 1000
                legend: "95"
          axes:
            left: { unit: ms }
      - graph:
          title: Update Workflow Latency
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: histogram_quantile(0.90, sum(rate(persistence_latency_bucket{operation="UpdateWorkflowExecution"}[$interval])) by (namespace, le)) * 1000
                legend: "90"
            - prometheus:
                query: histogram_quantile(0.95, sum(rate(persistence_latency_bucket{operation="UpdateWorkflowExecution"}[$interval])) by (namespace, le)) * 1000
                legend: "95"
          axes:
            left: { unit: ms }
      - graph:
          title: Get Workflow Execution Latency
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: histogram_quantile(0.90, sum (rate(persistence_latency_bucket{operation="GetWorkflowExecution"}[$interval])) by (namespace, le)) * 1000
                legend: "90"
            - prometheus:
                query: histogram_quantile(0.95, sum (rate(persistence_latency_bucket{operation="GetWorkflowExecution"}[$interval])) by (namespace, le)) * 1000
                legend: "95"
          axes:
            left: { unit: ms }
      - graph:
          title: Create Task
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: sum (rate(persistence_requests{operation=~"CreateTask"}[$interval])) by (operation)
                legend: "{{operation}}"
      - graph:
          title: Create Task Latency
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: histogram_quantile(0.90, sum(rate(persistence_latency_bucket{operation="CreateTask"}[$interval])) by (namespace, le)) * 1000
                legend: "90"
            - prometheus:
                query: histogram_quantile(0.95, sum(rate(persistence_latency_bucket{operation="CreateTask"}[$interval])) by (namespace, le)) * 1000
                legend: "95"
          axes:
            left: { unit: ms }
  - name: Tasks
    panels:
      - graph:
          title: Timer Task Latency p95
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: histogram_quantile(0.95, sum (rate(task_latency_queue_bucket{operation=~"Timer.*"}[$interval])) by (operation, le))
                legend: "{{operation}}"
          axes:
            left: { unit: s }
      - graph:
          title: Transfer Task Latency p95
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: histogram_quantile(0.95, sum (rate(task_latency_queue_bucket{operation=~"Transfer.*"}[$interval])) by (operation, le))
                legend: "{{operation}}"
          axes:
            left: { unit: s }
  - name: Locks
    panels:
      - graph:
          title: Workflow History Lock
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: histogram_quantile(0.99, sum (rate(cache_latency_bucket{operation="HistoryCacheGetOrCreate"}[$interval])) by (operation, le))
                legend: "{{operation}}"
          axes:
            left: { unit: s }
      - graph:
          title: Shard Lock
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: histogram_quantile(0.99, sum (rate(lock_latency_bucket{operation="ShardInfo"}[$interval])) by (operation, le))
                legend: "{{operation}}"
          axes:
            left: { unit: s }
  - name: Workers
    panels:
      - graph:
          title: Workflow Task Poll
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: sum (rate(k6_temporal_workflow_task_queue_poll_succeed[$interval])) by (task_queue)
                legend: "{{task_queue}} Succeed"
            - prometheus:
                query: sum (rate(k6_temporal_workflow_task_queue_poll_empty[$interval])) by (task_queue)
                legend: "{{task_queue}} Empty"
      - graph:
          title: Workflow Task Slots Available
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: sum (k6_temporal_worker_task_slots_available{worker_type="WorkflowWorker"}) by (task_queue)
                legend: "{{task_queue}}"
      - graph:
          title: Activity Task Poll
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: sum (rate(k6_temporal_activity_poll_no_task[$interval])) by (task_queue)
                legend: "{{task_queue}} Emtpy"
      - graph:
          title: Activity Task Slots Available
          datasource: temporal_prometheus
          targets:
            - prometheus:
                query: sum (k6_temporal_worker_task_slots_available{worker_type="ActivityWorker"})  by (task_queue)
                legend: "{{task_queue}}"